{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/yugansh/Downloads/inventory-management-system%20%281%29/lib/email-service.ts"],"sourcesContent":["import nodemailer from 'nodemailer'\n\nexport interface EmailConfig {\n  host: string\n  port: number\n  secure: boolean\n  auth: {\n    user: string\n    pass: string\n  }\n}\n\nexport interface EmailOptions {\n  to: string\n  subject: string\n  html: string\n  text?: string\n}\n\nclass EmailService {\n  private transporter: nodemailer.Transporter | null = null\n\n  private getConfig(): EmailConfig {\n    return {\n      host: process.env.SMTP_HOST || 'smtp.gmail.com',\n      port: parseInt(process.env.SMTP_PORT || '587'),\n      secure: false, // Use TLS\n      auth: {\n        user: process.env.SMTP_USER || '',\n        pass: process.env.SMTP_PASS || ''\n      }\n    }\n  }\n\n  private async getTransporter(): Promise<nodemailer.Transporter> {\n    if (!this.transporter) {\n      const config = this.getConfig()\n      \n      if (!config.auth.user || !config.auth.pass) {\n        throw new Error('Email configuration missing. Please set SMTP_USER and SMTP_PASS in your .env.local file')\n      }\n\n      this.transporter = nodemailer.createTransport(config)\n      \n      // Verify connection\n      try {\n        await this.transporter.verify()\n        console.log('Email server connection established successfully')\n      } catch (error) {\n        console.error('Failed to connect to email server:', error)\n        this.transporter = null\n        throw new Error('Email service connection failed. Please check your email configuration.')\n      }\n    }\n    \n    if (!this.transporter) {\n      throw new Error('Email transporter not initialized')\n    }\n    \n    return this.transporter\n  }\n\n  async sendOTP(email: string, otp: string): Promise<boolean> {\n    try {\n      const transporter = await this.getTransporter()\n      const appName = process.env.NEXT_PUBLIC_APP_NAME || 'StockMaster'\n      \n      const htmlContent = `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>OTP Verification - ${appName}</title>\n          <style>\n            body { font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }\n            .container { max-width: 600px; margin: 0 auto; background-color: white; }\n            .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }\n            .content { padding: 40px 30px; }\n            .otp-box { background: #f8f9fa; border: 2px dashed #e9ecef; border-radius: 10px; padding: 30px; text-align: center; margin: 30px 0; }\n            .otp-code { font-size: 36px; font-weight: bold; color: #495057; letter-spacing: 8px; font-family: 'Courier New', monospace; }\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; font-size: 14px; }\n            .btn { display: inline-block; padding: 12px 24px; background: #28a745; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0; }\n            .warning { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 15px; margin: 20px 0; color: #856404; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <h1>üîê ${appName}</h1>\n              <p>Password Reset Verification</p>\n            </div>\n            \n            <div class=\"content\">\n              <h2>Your OTP Code</h2>\n              <p>Hello,</p>\n              <p>You requested to reset your password for your ${appName} account. Please use the following One-Time Password (OTP) to proceed with your password reset:</p>\n              \n              <div class=\"otp-box\">\n                <div class=\"otp-code\">${otp}</div>\n                <p style=\"margin-top: 15px; color: #6c757d;\">Enter this code in the application</p>\n              </div>\n              \n              <div class=\"warning\">\n                <strong>‚ö†Ô∏è Important:</strong>\n                <ul style=\"margin: 10px 0; padding-left: 20px;\">\n                  <li>This OTP is valid for <strong>5 minutes</strong> only</li>\n                  <li>Don't share this code with anyone</li>\n                  <li>If you didn't request this, please ignore this email</li>\n                </ul>\n              </div>\n              \n              <p>If you're having trouble, you can copy and paste the OTP code above into the application.</p>\n              \n              <p>Best regards,<br>The ${appName} Team</p>\n            </div>\n            \n            <div class=\"footer\">\n              <p>This is an automated email from ${appName} Inventory Management System</p>\n              <p>Generated on: ${new Date().toLocaleString()}</p>\n            </div>\n          </div>\n        </body>\n        </html>\n      `\n\n      const textContent = `\n${appName} - Password Reset OTP\n\nYour OTP Code: ${otp}\n\nYou requested to reset your password. Please use this One-Time Password (OTP) to proceed with your password reset.\n\nThis OTP is valid for 5 minutes only. Don't share this code with anyone.\n\nIf you didn't request this, please ignore this email.\n\nBest regards,\nThe ${appName} Team\n\nGenerated on: ${new Date().toLocaleString()}\n      `\n\n      const mailOptions: EmailOptions = {\n        to: email,\n        subject: `üîê Password Reset OTP for ${appName}`,\n        html: htmlContent,\n        text: textContent\n      }\n\n      const info = await transporter.sendMail({\n        from: `\"${appName}\" <${this.getConfig().auth.user}>`,\n        ...mailOptions\n      })\n\n      console.log('OTP email sent successfully:', info.messageId)\n      return true\n    } catch (error) {\n      console.error('Failed to send OTP email:', error)\n      return false\n    }\n  }\n\n  async sendLowStockAlert(recipients: string[], products: any[]): Promise<boolean> {\n    try {\n      const transporter = await this.getTransporter()\n      const appName = process.env.NEXT_PUBLIC_APP_NAME || 'StockMaster'\n      \n      const htmlContent = `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>Low Stock Alert - ${appName}</title>\n          <style>\n            body { font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }\n            .container { max-width: 600px; margin: 0 auto; background-color: white; }\n            .header { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; padding: 30px; text-align: center; }\n            .content { padding: 40px 30px; }\n            .alert-item { background: #fff5f5; border-left: 4px solid #f56565; padding: 15px; margin: 10px 0; border-radius: 5px; }\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; font-size: 14px; }\n            .critical { background: #fed7d7; border-left-color: #e53e3e; }\n            .warning { background: #fefcbf; border-left-color: #d69e2e; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <h1>üö® ${appName}</h1>\n              <p>Low Stock Alert</p>\n            </div>\n            \n            <div class=\"content\">\n              <h2>Attention Required!</h2>\n              <p>The following products are running low and need to be restocked:</p>\n              \n              ${products.map(product => `\n                <div class=\"alert-item ${product.stock === 0 ? 'critical' : 'warning'}\">\n                  <h3 style=\"margin: 0 0 10px 0;\">${product.name}</h3>\n                  <p style=\"margin: 0;\"><strong>SKU:</strong> ${product.sku}</p>\n                  <p style=\"margin: 0;\"><strong>Current Stock:</strong> ${product.stock} ${product.uom}</p>\n                  <p style=\"margin: 0;\"><strong>Reorder Level:</strong> ${product.reorderLevel || 'Not set'} ${product.uom}</p>\n                  <p style=\"margin: 0;\"><strong>Category:</strong> ${product.category}</p>\n                  ${product.stock === 0 ? '<p style=\"color: #e53e3e; font-weight: bold; margin: 5px 0 0 0;\">‚ö†Ô∏è OUT OF STOCK</p>' : ''}\n                </div>\n              `).join('')}\n              \n              <p style=\"margin-top: 30px;\">Please review these items and place orders as needed to maintain adequate inventory levels.</p>\n              \n              <p>Best regards,<br>The ${appName} System</p>\n            </div>\n            \n            <div class=\"footer\">\n              <p>This is an automated alert from ${appName} Inventory Management System</p>\n              <p>Generated on: ${new Date().toLocaleString()}</p>\n            </div>\n          </div>\n        </body>\n        </html>\n      `\n\n      const textContent = `\n${appName} - Low Stock Alert\n\n${products.length} products need attention:\n\n${products.map(product => `\n‚Ä¢ ${product.name} (${product.sku})\n  Current Stock: ${product.stock} ${product.uom}\n  Reorder Level: ${product.reorderLevel || 'Not set'} ${product.uom}\n  Category: ${product.category}\n  ${product.stock === 0 ? '‚ö†Ô∏è OUT OF STOCK' : ''}\n`).join('\\n')}\n\nPlease review and place orders as needed.\n\nBest regards,\nThe ${appName} System\n\nGenerated on: ${new Date().toLocaleString()}\n      `\n\n      // Send to all recipients\n      const sendPromises = recipients.map(async (recipient) => {\n        try {\n          const info = await transporter.sendMail({\n            from: `\"${appName} Alerts\" <${this.getConfig().auth.user}>`,\n            to: recipient,\n            subject: `üö® Low Stock Alert - ${products.length} Products Need Attention`,\n            html: htmlContent,\n            text: textContent\n          })\n          console.log(`Low stock alert sent to ${recipient}:`, info.messageId)\n          return true\n        } catch (error) {\n          console.error(`Failed to send alert to ${recipient}:`, error)\n          return false\n        }\n      })\n\n      const results = await Promise.all(sendPromises)\n      return results.every(result => result)\n    } catch (error) {\n      console.error('Failed to send low stock alerts:', error)\n      return false\n    }\n  }\n\n  async testConnection(): Promise<boolean> {\n    try {\n      const transporter = await this.getTransporter()\n      await transporter.verify()\n      return true\n    } catch (error) {\n      console.error('Email service test failed:', error)\n      return false\n    }\n  }\n}\n\nexport const emailService = new EmailService()\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 389, "column": 0}, "map": {"version":3,"sources":["file:///Users/yugansh/Downloads/inventory-management-system%20%281%29/app/api/notifications/send-alert/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { emailService } from '@/lib/email-service'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { recipient, products } = await request.json()\n\n    if (!recipient || !products || !Array.isArray(products)) {\n      return NextResponse.json(\n        { error: 'Recipient and products array are required' },\n        { status: 400 }\n      )\n    }\n\n    const success = await emailService.sendLowStockAlert([recipient], products)\n\n    if (success) {\n      return NextResponse.json(\n        { message: 'Low stock alert sent successfully' },\n        { status: 200 }\n      )\n    } else {\n      return NextResponse.json(\n        { error: 'Failed to send low stock alert' },\n        { status: 500 }\n      )\n    }\n  } catch (error) {\n    console.error('Send alert error:', error)\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAElD,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,MAAM,OAAO,CAAC,WAAW;YACvD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4C,GACrD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,UAAU,MAAM,yIAAY,CAAC,iBAAiB,CAAC;YAAC;SAAU,EAAE;QAElE,IAAI,SAAS;YACX,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAoC,GAC/C;gBAAE,QAAQ;YAAI;QAElB,OAAO;YACL,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiC,GAC1C;gBAAE,QAAQ;YAAI;QAElB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}