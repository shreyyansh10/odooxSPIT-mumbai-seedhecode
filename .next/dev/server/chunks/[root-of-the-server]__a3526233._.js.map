{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/yugansh/Downloads/inventory-management-system%20%281%29/lib/email-service.ts"],"sourcesContent":["import nodemailer from 'nodemailer'\n\nexport interface EmailConfig {\n  host: string\n  port: number\n  secure: boolean\n  auth: {\n    user: string\n    pass: string\n  }\n}\n\nexport interface EmailOptions {\n  to: string\n  subject: string\n  html: string\n  text?: string\n}\n\nclass EmailService {\n  private transporter: nodemailer.Transporter | null = null\n\n  private getConfig(): EmailConfig {\n    return {\n      host: process.env.SMTP_HOST || 'smtp.gmail.com',\n      port: parseInt(process.env.SMTP_PORT || '587'),\n      secure: false, // Use TLS\n      auth: {\n        user: process.env.SMTP_USER || '',\n        pass: process.env.SMTP_PASS || ''\n      }\n    }\n  }\n\n  private async getTransporter(): Promise<nodemailer.Transporter> {\n    if (!this.transporter) {\n      const config = this.getConfig()\n      \n      if (!config.auth.user || !config.auth.pass) {\n        throw new Error('Email configuration missing. Please set SMTP_USER and SMTP_PASS in your .env.local file')\n      }\n\n      this.transporter = nodemailer.createTransport(config)\n      \n      // Verify connection\n      try {\n        await this.transporter.verify()\n        console.log('Email server connection established successfully')\n      } catch (error) {\n        console.error('Failed to connect to email server:', error)\n        this.transporter = null\n        throw new Error('Email service connection failed. Please check your email configuration.')\n      }\n    }\n    \n    if (!this.transporter) {\n      throw new Error('Email transporter not initialized')\n    }\n    \n    return this.transporter\n  }\n\n  async sendOTP(email: string, otp: string): Promise<boolean> {\n    try {\n      const transporter = await this.getTransporter()\n      const appName = process.env.NEXT_PUBLIC_APP_NAME || 'StockMaster'\n      \n      const htmlContent = `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>OTP Verification - ${appName}</title>\n          <style>\n            body { font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }\n            .container { max-width: 600px; margin: 0 auto; background-color: white; }\n            .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }\n            .content { padding: 40px 30px; }\n            .otp-box { background: #f8f9fa; border: 2px dashed #e9ecef; border-radius: 10px; padding: 30px; text-align: center; margin: 30px 0; }\n            .otp-code { font-size: 36px; font-weight: bold; color: #495057; letter-spacing: 8px; font-family: 'Courier New', monospace; }\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; font-size: 14px; }\n            .btn { display: inline-block; padding: 12px 24px; background: #28a745; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0; }\n            .warning { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 15px; margin: 20px 0; color: #856404; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <h1>üîê ${appName}</h1>\n              <p>Password Reset Verification</p>\n            </div>\n            \n            <div class=\"content\">\n              <h2>Your OTP Code</h2>\n              <p>Hello,</p>\n              <p>You requested to reset your password for your ${appName} account. Please use the following One-Time Password (OTP) to proceed with your password reset:</p>\n              \n              <div class=\"otp-box\">\n                <div class=\"otp-code\">${otp}</div>\n                <p style=\"margin-top: 15px; color: #6c757d;\">Enter this code in the application</p>\n              </div>\n              \n              <div class=\"warning\">\n                <strong>‚ö†Ô∏è Important:</strong>\n                <ul style=\"margin: 10px 0; padding-left: 20px;\">\n                  <li>This OTP is valid for <strong>5 minutes</strong> only</li>\n                  <li>Don't share this code with anyone</li>\n                  <li>If you didn't request this, please ignore this email</li>\n                </ul>\n              </div>\n              \n              <p>If you're having trouble, you can copy and paste the OTP code above into the application.</p>\n              \n              <p>Best regards,<br>The ${appName} Team</p>\n            </div>\n            \n            <div class=\"footer\">\n              <p>This is an automated email from ${appName} Inventory Management System</p>\n              <p>Generated on: ${new Date().toLocaleString()}</p>\n            </div>\n          </div>\n        </body>\n        </html>\n      `\n\n      const textContent = `\n${appName} - Password Reset OTP\n\nYour OTP Code: ${otp}\n\nYou requested to reset your password. Please use this One-Time Password (OTP) to proceed with your password reset.\n\nThis OTP is valid for 5 minutes only. Don't share this code with anyone.\n\nIf you didn't request this, please ignore this email.\n\nBest regards,\nThe ${appName} Team\n\nGenerated on: ${new Date().toLocaleString()}\n      `\n\n      const mailOptions: EmailOptions = {\n        to: email,\n        subject: `üîê Password Reset OTP for ${appName}`,\n        html: htmlContent,\n        text: textContent\n      }\n\n      const info = await transporter.sendMail({\n        from: `\"${appName}\" <${this.getConfig().auth.user}>`,\n        ...mailOptions\n      })\n\n      console.log('OTP email sent successfully:', info.messageId)\n      return true\n    } catch (error) {\n      console.error('Failed to send OTP email:', error)\n      return false\n    }\n  }\n\n  async sendLowStockAlert(recipients: string[], products: any[]): Promise<boolean> {\n    try {\n      const transporter = await this.getTransporter()\n      const appName = process.env.NEXT_PUBLIC_APP_NAME || 'StockMaster'\n      \n      const htmlContent = `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>Low Stock Alert - ${appName}</title>\n          <style>\n            body { font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }\n            .container { max-width: 600px; margin: 0 auto; background-color: white; }\n            .header { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; padding: 30px; text-align: center; }\n            .content { padding: 40px 30px; }\n            .alert-item { background: #fff5f5; border-left: 4px solid #f56565; padding: 15px; margin: 10px 0; border-radius: 5px; }\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; font-size: 14px; }\n            .critical { background: #fed7d7; border-left-color: #e53e3e; }\n            .warning { background: #fefcbf; border-left-color: #d69e2e; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <h1>üö® ${appName}</h1>\n              <p>Low Stock Alert</p>\n            </div>\n            \n            <div class=\"content\">\n              <h2>Attention Required!</h2>\n              <p>The following products are running low and need to be restocked:</p>\n              \n              ${products.map(product => `\n                <div class=\"alert-item ${product.stock === 0 ? 'critical' : 'warning'}\">\n                  <h3 style=\"margin: 0 0 10px 0;\">${product.name}</h3>\n                  <p style=\"margin: 0;\"><strong>SKU:</strong> ${product.sku}</p>\n                  <p style=\"margin: 0;\"><strong>Current Stock:</strong> ${product.stock} ${product.uom}</p>\n                  <p style=\"margin: 0;\"><strong>Reorder Level:</strong> ${product.reorderLevel || 'Not set'} ${product.uom}</p>\n                  <p style=\"margin: 0;\"><strong>Category:</strong> ${product.category}</p>\n                  ${product.stock === 0 ? '<p style=\"color: #e53e3e; font-weight: bold; margin: 5px 0 0 0;\">‚ö†Ô∏è OUT OF STOCK</p>' : ''}\n                </div>\n              `).join('')}\n              \n              <p style=\"margin-top: 30px;\">Please review these items and place orders as needed to maintain adequate inventory levels.</p>\n              \n              <p>Best regards,<br>The ${appName} System</p>\n            </div>\n            \n            <div class=\"footer\">\n              <p>This is an automated alert from ${appName} Inventory Management System</p>\n              <p>Generated on: ${new Date().toLocaleString()}</p>\n            </div>\n          </div>\n        </body>\n        </html>\n      `\n\n      const textContent = `\n${appName} - Low Stock Alert\n\n${products.length} products need attention:\n\n${products.map(product => `\n‚Ä¢ ${product.name} (${product.sku})\n  Current Stock: ${product.stock} ${product.uom}\n  Reorder Level: ${product.reorderLevel || 'Not set'} ${product.uom}\n  Category: ${product.category}\n  ${product.stock === 0 ? '‚ö†Ô∏è OUT OF STOCK' : ''}\n`).join('\\n')}\n\nPlease review and place orders as needed.\n\nBest regards,\nThe ${appName} System\n\nGenerated on: ${new Date().toLocaleString()}\n      `\n\n      // Send to all recipients\n      const sendPromises = recipients.map(async (recipient) => {\n        try {\n          const info = await transporter.sendMail({\n            from: `\"${appName} Alerts\" <${this.getConfig().auth.user}>`,\n            to: recipient,\n            subject: `üö® Low Stock Alert - ${products.length} Products Need Attention`,\n            html: htmlContent,\n            text: textContent\n          })\n          console.log(`Low stock alert sent to ${recipient}:`, info.messageId)\n          return true\n        } catch (error) {\n          console.error(`Failed to send alert to ${recipient}:`, error)\n          return false\n        }\n      })\n\n      const results = await Promise.all(sendPromises)\n      return results.every(result => result)\n    } catch (error) {\n      console.error('Failed to send low stock alerts:', error)\n      return false\n    }\n  }\n\n  async testConnection(): Promise<boolean> {\n    try {\n      const transporter = await this.getTransporter()\n      await transporter.verify()\n      return true\n    } catch (error) {\n      console.error('Email service test failed:', error)\n      return false\n    }\n  }\n}\n\nexport const emailService = new EmailService()\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 389, "column": 0}, "map": {"version":3,"sources":["file:///Users/yugansh/Downloads/inventory-management-system%20%281%29/lib/auth-store.ts"],"sourcesContent":["// Authentication store with OTP support\nexport interface AuthUser {\n  id: string\n  email: string\n  name: string\n  role: \"admin\" | \"manager\" | \"staff\"\n}\n\ninterface AuthStore {\n  users: Map<string, { password: string; name: string; role: string; otpCode?: string; otpExpiry?: number }>\n  currentUser: AuthUser | null\n}\n\nconst AUTH_STORAGE_KEY = \"auth_store\"\nconst OTP_EXPIRY = 5 * 60 * 1000 // 5 minutes\n\nexport const authStore = {\n  initializeAuth: () => {\n    if (typeof window === \"undefined\") return\n    const existing = localStorage.getItem(AUTH_STORAGE_KEY)\n    if (!existing) {\n      const initialAuth = {\n        users: {\n          \"demo@example.com\": { password: \"demo123\", name: \"Demo User\", role: \"admin\" },\n          \"yuganshvthacker@gmail.com\": { password: \"\", name: \"Yugansh Thacker\", role: \"admin\" },\n        },\n      }\n      localStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(initialAuth))\n    }\n  },\n\n  getAuthData: () => {\n    if (typeof window === \"undefined\") return { users: {}, currentUser: null }\n    authStore.initializeAuth()\n    try {\n      const data = localStorage.getItem(AUTH_STORAGE_KEY)\n      return data ? JSON.parse(data) : { users: {}, currentUser: null }\n    } catch {\n      return { users: {}, currentUser: null }\n    }\n  },\n\n  saveAuthData: (data: any) => {\n    if (typeof window === \"undefined\") return\n    try {\n      localStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(data))\n    } catch {\n      console.error(\"Failed to save auth data\")\n    }\n  },\n\n  signup: (email: string, password: string, name: string): AuthUser => {\n    const data = authStore.getAuthData()\n    if (data.users[email]) {\n      throw new Error(\"Email already registered\")\n    }\n    data.users[email] = { password, name, role: \"staff\" }\n    authStore.saveAuthData(data)\n    return { id: email, email, name, role: \"staff\" as const }\n  },\n\n  login: (email: string, password: string) => {\n    const data = authStore.getAuthData()\n    const user = data.users[email]\n    if (!user || user.password !== password) {\n      throw new Error(\"Invalid email or password\")\n    }\n    const authUser: AuthUser = { id: email, email, name: user.name, role: user.role as AuthUser['role'] }\n    data.currentUser = authUser\n    authStore.saveAuthData(data)\n    return authUser\n  },\n\n  logout: () => {\n    const data = authStore.getAuthData()\n    data.currentUser = null\n    authStore.saveAuthData(data)\n  },\n\n  getCurrentUser: () => {\n    const data = authStore.getAuthData()\n    return data.currentUser\n  },\n\n  requestOTP: async (email: string) => {\n    try {\n      const response = await fetch('/api/auth/request-otp', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ email }),\n      })\n\n      const data = await response.json()\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Failed to send OTP')\n      }\n\n      return true\n    } catch (error) {\n      console.error('OTP request failed:', error)\n      throw error\n    }\n  },\n\n  verifyOTP: (email: string, otp: string) => {\n    const data = authStore.getAuthData()\n    const user = data.users[email]\n    if (!user || user.otpCode !== otp) {\n      throw new Error(\"Invalid OTP\")\n    }\n    if (user.otpExpiry && user.otpExpiry < Date.now()) {\n      throw new Error(\"OTP expired\")\n    }\n    user.otpCode = undefined\n    user.otpExpiry = undefined\n    authStore.saveAuthData(data)\n    return true\n  },\n\n  resetPassword: (email: string, newPassword: string) => {\n    const data = authStore.getAuthData()\n    const user = data.users[email]\n    if (!user) {\n      throw new Error(\"Email not found\")\n    }\n    user.password = newPassword\n    authStore.saveAuthData(data)\n    return true\n  },\n}\n"],"names":[],"mappings":"AAAA,wCAAwC;;;;;AAaxC,MAAM,mBAAmB;AACzB,MAAM,aAAa,IAAI,KAAK,KAAK,YAAY;;AAEtC,MAAM,YAAY;IACvB,gBAAgB;QACd,wCAAmC;;;QACnC,MAAM;IAUR;IAEA,aAAa;QACX,wCAAmC,OAAO;YAAE,OAAO,CAAC;YAAG,aAAa;QAAK;;;IAQ3E;IAEA,cAAc,CAAC;QACb,wCAAmC;;;IAMrC;IAEA,QAAQ,CAAC,OAAe,UAAkB;QACxC,MAAM,OAAO,UAAU,WAAW;QAClC,IAAI,KAAK,KAAK,CAAC,MAAM,EAAE;YACrB,MAAM,IAAI,MAAM;QAClB;QACA,KAAK,KAAK,CAAC,MAAM,GAAG;YAAE;YAAU;YAAM,MAAM;QAAQ;QACpD,UAAU,YAAY,CAAC;QACvB,OAAO;YAAE,IAAI;YAAO;YAAO;YAAM,MAAM;QAAiB;IAC1D;IAEA,OAAO,CAAC,OAAe;QACrB,MAAM,OAAO,UAAU,WAAW;QAClC,MAAM,OAAO,KAAK,KAAK,CAAC,MAAM;QAC9B,IAAI,CAAC,QAAQ,KAAK,QAAQ,KAAK,UAAU;YACvC,MAAM,IAAI,MAAM;QAClB;QACA,MAAM,WAAqB;YAAE,IAAI;YAAO;YAAO,MAAM,KAAK,IAAI;YAAE,MAAM,KAAK,IAAI;QAAqB;QACpG,KAAK,WAAW,GAAG;QACnB,UAAU,YAAY,CAAC;QACvB,OAAO;IACT;IAEA,QAAQ;QACN,MAAM,OAAO,UAAU,WAAW;QAClC,KAAK,WAAW,GAAG;QACnB,UAAU,YAAY,CAAC;IACzB;IAEA,gBAAgB;QACd,MAAM,OAAO,UAAU,WAAW;QAClC,OAAO,KAAK,WAAW;IACzB;IAEA,YAAY,OAAO;QACjB,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,yBAAyB;gBACpD,QAAQ;gBACR,SAAS;oBACP,gBAAgB;gBAClB;gBACA,MAAM,KAAK,SAAS,CAAC;oBAAE;gBAAM;YAC/B;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAEhC,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI;YAChC;YAEA,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,uBAAuB;YACrC,MAAM;QACR;IACF;IAEA,WAAW,CAAC,OAAe;QACzB,MAAM,OAAO,UAAU,WAAW;QAClC,MAAM,OAAO,KAAK,KAAK,CAAC,MAAM;QAC9B,IAAI,CAAC,QAAQ,KAAK,OAAO,KAAK,KAAK;YACjC,MAAM,IAAI,MAAM;QAClB;QACA,IAAI,KAAK,SAAS,IAAI,KAAK,SAAS,GAAG,KAAK,GAAG,IAAI;YACjD,MAAM,IAAI,MAAM;QAClB;QACA,KAAK,OAAO,GAAG;QACf,KAAK,SAAS,GAAG;QACjB,UAAU,YAAY,CAAC;QACvB,OAAO;IACT;IAEA,eAAe,CAAC,OAAe;QAC7B,MAAM,OAAO,UAAU,WAAW;QAClC,MAAM,OAAO,KAAK,KAAK,CAAC,MAAM;QAC9B,IAAI,CAAC,MAAM;YACT,MAAM,IAAI,MAAM;QAClB;QACA,KAAK,QAAQ,GAAG;QAChB,UAAU,YAAY,CAAC;QACvB,OAAO;IACT;AACF"}},
    {"offset": {"line": 510, "column": 0}, "map": {"version":3,"sources":["file:///Users/yugansh/Downloads/inventory-management-system%20%281%29/app/api/auth/request-otp/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { emailService } from '@/lib/email-service'\nimport { authStore } from '@/lib/auth-store'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { email } = await request.json()\n\n    if (!email) {\n      return NextResponse.json(\n        { error: 'Email is required' },\n        { status: 400 }\n      )\n    }\n\n    // Get auth data\n    const authData = authStore.getAuthData()\n    \n    // Generate OTP\n    const otp = Math.random().toString().slice(2, 8)\n    const otpExpiry = Date.now() + (5 * 60 * 1000) // 5 minutes\n\n    // Check if user exists, if not create a temporary entry for OTP\n    let user = authData.users[email]\n    if (!user) {\n      // Create temporary user entry for password reset\n      authData.users[email] = {\n        password: '', // Will be set when they reset password\n        name: email.split('@')[0], // Use email prefix as name\n        role: 'staff', // Default role\n        isTemporary: true // Mark as temporary until password is set\n      }\n      user = authData.users[email]\n    }\n\n    // Store OTP in auth data\n    user.otpCode = otp\n    user.otpExpiry = otpExpiry\n    authStore.saveAuthData(authData)\n\n    // Send OTP email\n    const emailSent = await emailService.sendOTP(email, otp)\n\n    if (!emailSent) {\n      return NextResponse.json(\n        { error: 'Failed to send OTP email. Please check your email configuration.' },\n        { status: 500 }\n      )\n    }\n\n    return NextResponse.json(\n      { message: 'OTP sent successfully to your email' },\n      { status: 200 }\n    )\n  } catch (error) {\n    console.error('OTP request error:', error)\n    return NextResponse.json(\n      { error: 'Internal server error. Please check your email configuration.' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEpC,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAElB;QAEA,gBAAgB;QAChB,MAAM,WAAW,mIAAS,CAAC,WAAW;QAEtC,eAAe;QACf,MAAM,MAAM,KAAK,MAAM,GAAG,QAAQ,GAAG,KAAK,CAAC,GAAG;QAC9C,MAAM,YAAY,KAAK,GAAG,KAAM,IAAI,KAAK,KAAM,YAAY;;QAE3D,gEAAgE;QAChE,IAAI,OAAO,SAAS,KAAK,CAAC,MAAM;QAChC,IAAI,CAAC,MAAM;YACT,iDAAiD;YACjD,SAAS,KAAK,CAAC,MAAM,GAAG;gBACtB,UAAU;gBACV,MAAM,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;gBACzB,MAAM;gBACN,aAAa,KAAK,0CAA0C;YAC9D;YACA,OAAO,SAAS,KAAK,CAAC,MAAM;QAC9B;QAEA,yBAAyB;QACzB,KAAK,OAAO,GAAG;QACf,KAAK,SAAS,GAAG;QACjB,mIAAS,CAAC,YAAY,CAAC;QAEvB,iBAAiB;QACjB,MAAM,YAAY,MAAM,yIAAY,CAAC,OAAO,CAAC,OAAO;QAEpD,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAmE,GAC5E;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;QAAsC,GACjD;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAgE,GACzE;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}